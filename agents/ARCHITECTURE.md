# Архитектура AI Pod

## 🏗️ Общая архитектура

```
┌─────────────────────────────────────────────────────────┐
│                    Frontend (React)                       │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │  Components  │  │   Services   │  │    Types     │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
└─────────────────────────────────────────────────────────┘
                          │
                          ▼
┌─────────────────────────────────────────────────────────┐
│              Services Layer (Бизнес-логика)             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐   │
│  │      DB      │  │    Gemini    │  │  Telegram    │   │
│  │   Service    │  │   Service    │  │   Service    │   │
│  └──────────────┘  └──────────────┘  └──────────────┘   │
└─────────────────────────────────────────────────────────┘
                          │
        ┌─────────────────┼─────────────────┐
        ▼                 ▼                 ▼
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│   Supabase   │  │ Google Sheets│  │ LocalStorage │
│   (Optional) │  │  (Optional)  │  │  (Fallback)  │
└──────────────┘  └──────────────┘  └──────────────┘
```

## 📦 Компоненты

### Frontend Components

#### `App.tsx`
- Главный компонент приложения
- Управляет состоянием пользователя
- Обрабатывает загрузку данных
- Показывает Boot Sequence при старте

#### `TeenDashboard.tsx`
- Основной дашборд для подростков
- Отображает задачи, прогресс, XP
- Навигация по неделям
- Интеграция с мини-играми

#### `ParentDashboard.tsx`
- Дашборд для родителей
- Мониторинг прогресса детей
- Статистика и аналитика

#### `CuratorDashboard.tsx`
- Дашборд для кураторов
- Управление группой студентов
- Отслеживание прогресса всех

#### `KatyaChat.tsx`
- Чат с AI-наставником
- Интеграция с Gemini API
- Персонализированные ответы

#### `TaskModal.tsx`
- Модальное окно урока
- Отображение слайдов
- Интерактивные элементы

#### `MiniGames.tsx`
- Мини-игры для обучения
- FOCUS_DEFENDER - защита от отвлечений
- NEURO_MATCH - поиск пар

## 🔌 Services

### `db.ts` - Database Service
**Приоритет хранения:**
1. Google Sheets (если URL предоставлен)
2. Supabase (если ключи предоставлены)
3. LocalStorage (fallback)

**Основные функции:**
- `getOrCreateUser()` - получение/создание пользователя
- `completeTask()` - завершение задачи
- `updateUserProfile()` - обновление профиля
- `getAllStudentsStats()` - статистика всех студентов

### `geminiService.ts` - AI Service
**Функции:**
- `askKatya()` - чат с AI-наставником
- `adaptTaskContent()` - адаптация контента под интересы

**Особенности:**
- Использует интересы пользователя для персонализации
- Адаптирует метафоры под хобби (гейминг, спорт, аниме)

### `telegramService.ts` - Telegram Integration
**Функции:**
- `initTelegramApp()` - инициализация WebApp
- `getTelegramUser()` - получение данных пользователя
- `isTelegramApp()` - проверка запуска в Telegram

### `supabaseClient.ts` - Supabase Client
- Настройка подключения к Supabase
- Опциональная интеграция

### `googleSheetsService.ts` - Google Sheets Integration
- Чтение/запись данных в Google Sheets
- Опциональная интеграция

## 🎯 Поток данных

### Инициализация приложения

```
1. App.tsx загружается
2. initTelegramApp() - инициализация Telegram
3. getTelegramUser() - получение данных пользователя
4. getOrCreateUser() - загрузка/создание пользователя
   ├─ Проверка Google Sheets
   ├─ Проверка Supabase
   └─ Fallback на LocalStorage
5. Отображение соответствующего дашборда
```

### Завершение задачи

```
1. Пользователь завершает задачу
2. handleTaskComplete() в App.tsx
3. Оптимистичное обновление UI
4. completeTask() в db.ts
   ├─ Обновление LocalStorage
   ├─ Синхронизация с Google Sheets (если доступно)
   └─ Синхронизация с Supabase (если доступно)
5. Обновление UI с новыми данными
```

### Чат с Катей

```
1. Пользователь отправляет сообщение
2. KatyaChat.tsx получает сообщение
3. askKatya() в geminiService.ts
4. Формирование промпта с контекстом пользователя
5. Запрос к Gemini API
6. Возврат персонализированного ответа
7. Отображение в чате
```

## 🔄 Состояние приложения

### Глобальное состояние
- `currentUser` - текущий пользователь
- `isBooting` - состояние загрузки
- `isLoadingData` - загрузка данных

### Локальное состояние компонентов
- Каждый компонент управляет своим UI-состоянием
- Данные синхронизируются через сервисы

## 🎨 UI/UX паттерны

1. **Boot Sequence** - анимированная загрузка
2. **Glassmorphism** - стеклянные панели
3. **Aurora Background** - жидкий фон
4. **Gamification UI** - XP бары, уровни, монеты
5. **Responsive Design** - адаптивность

## 🔐 Безопасность

- API ключи хранятся в `.env.local`
- Telegram WebApp использует initData для аутентификации
- Supabase использует Row Level Security (если настроено)

## 📱 Платформы

- **Web**: React приложение (Vite)
- **Telegram WebApp**: Встроенное в Telegram
- **Telegram Bot**: Отдельный бот для команд

## 🚀 Деплой

- **Frontend**: GitHub Pages
- **Telegram Bot**: Node.js сервер (любой хостинг)
- **Database**: Supabase или Google Sheets



