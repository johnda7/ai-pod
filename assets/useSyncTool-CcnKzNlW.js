import{r,h as l,s as S,l as b}from"./index-DMwL-01H.js";function C(y,g){const{storageKey:c,debounceMs:u=1e3}=g,[n,i]=r.useState(y),[m,a]=r.useState("idle"),[T,d]=r.useState(!0),[f,p]=r.useState(!1);r.useEffect(()=>{(async()=>{d(!0);try{const t=localStorage.getItem(c);if(t){const s=JSON.parse(t);i(s)}}catch(t){console.error("❌ Error loading from localStorage:",t)}const e=l();if(e!=null&&e.id)try{if(await b(e.id.toString())){const s=localStorage.getItem(c);s&&i(JSON.parse(s))}}catch(t){console.error("❌ Error loading from Supabase:",t)}d(!1),p(!0)})()},[c]),r.useEffect(()=>{if(!f)return;try{localStorage.setItem(c,JSON.stringify(n))}catch(t){console.error("❌ Error saving to localStorage:",t)}const e=setTimeout(async()=>{const t=l();if(t!=null&&t.id){a("syncing");try{const s=await S(t.id.toString());a(s?"synced":"error"),s&&setTimeout(()=>a("idle"),2e3)}catch(s){console.error("❌ Sync error:",s),a("error")}}},u);return()=>clearTimeout(e)},[n,c,u,f]);const h=r.useCallback(async()=>{const o=l();if(o!=null&&o.id){a("syncing");try{const e=await S(o.id.toString());a(e?"synced":"error"),e&&setTimeout(()=>a("idle"),2e3)}catch{a("error")}}},[]),I=r.useCallback(o=>{i(e=>typeof o=="function"?o(e):o)},[]);return{data:n,setData:I,syncStatus:m,isLoading:T,forceSync:h}}export{C as u};
