# ‚úÖ –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Supabase

## üéâ –•–æ—Ä–æ—à–∏–µ –Ω–æ–≤–æ—Å—Ç–∏!

–í–∞—à –ø—Ä–æ–µ–∫—Ç Supabase **—É–∂–µ –ø–æ–¥–∫–ª—é—á–µ–Ω** –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç:
- ‚úÖ URL: `https://rnxqyltjbcwqwblnhuhm.supabase.co`
- ‚úÖ –¢–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç: `users` (17 –∑–∞–ø–∏—Å–µ–π), `progress` (1 –∑–∞–ø–∏—Å—å)
- ‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ –∫–æ–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –°–ï–ô–ß–ê–°

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –æ–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü

–¢–∞–±–ª–∏—Ü—ã —É–∂–µ –µ—Å—Ç—å, –Ω–æ –Ω—É–∂–Ω–æ —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ –ø–æ–ª—è –Ω–∞ –º–µ—Å—Ç–µ:

1. –û—Ç–∫—Ä–æ–π—Ç–µ: https://supabase.com/dashboard/project/rnxqyltjbcwqwblnhuhm
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **SQL Editor** (–ª–µ–≤–æ–µ –º–µ–Ω—é)
3. –ù–∞–∂–º–∏—Ç–µ **New Query**
4. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `scripts/check-and-fix-schema.sql`
5. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **–≤–µ—Å—å** SQL –∫–æ–¥
6. –í—Å—Ç–∞–≤—å—Ç–µ –≤ SQL Editor
7. –ù–∞–∂–º–∏—Ç–µ **Run** (–∏–ª–∏ Ctrl+Enter)

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–æ–ª—è
- ‚úÖ –î–æ–±–∞–≤–∏—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ø–æ–ª—è (–±–µ–∑–æ–ø–∞—Å–Ω–æ!)
- ‚úÖ –°–æ–∑–¥–∞—Å—Ç –∏–Ω–¥–µ–∫—Å—ã
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç RLS –ø–æ–ª–∏—Ç–∏–∫–∏
- ‚úÖ **–ù–ï —É–¥–∞–ª–∏—Ç** —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç–∞ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:

```sql
-- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã users
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'users'
ORDER BY ordinal_position;

-- –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
SELECT id, telegram_id, name, xp, coins, level, inventory 
FROM users 
LIMIT 5;
```

–î–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø–æ–ª—è:
- `id`, `telegram_id`, `username`, `name`, `role`
- `xp`, `coins`, `level`, `hp`, `max_hp`
- `avatar_url`, `streak`, `interest`, `inventory`, `league`

### –®–∞–≥ 3: –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ (F12) –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ Supabase —É—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∞: https://rnxqyltjbcwqwblnhuhm.supabase.co`

### –®–∞–≥ 4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Ä–∞–±–æ—Ç—É

1. **–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Telegram**
   - –î–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∏–∑ Supabase
   - –í –∫–æ–Ω—Å–æ–ª–∏: `‚úÖ Found User in Supabase: [–∏–º—è]`
   - –í –∫–æ–Ω—Å–æ–ª–∏: `üìä Loaded X completed tasks from Supabase`

2. **–ó–∞–≤–µ—Ä—à–∏—Ç–µ –∑–∞–¥–∞—á—É**
   - –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ Task completed and synced to Supabase: t1`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard ‚Üí Table Editor ‚Üí progress

3. **–ö—É–ø–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –≤ –º–∞–≥–∞–∑–∏–Ω–µ**
   - –í –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å: `‚úÖ Purchase synced to Supabase: [item_id]`
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ Supabase Dashboard ‚Üí Table Editor ‚Üí users (–ø–æ–ª–µ `inventory`)

4. **–û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É**
   - –ü—Ä–æ–≥—Ä–µ—Å—Å –¥–æ–ª–∂–µ–Ω —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å—Å—è
   - –í—Å–µ –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –∏–∑ Supabase

## üêõ –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ü—Ä–æ–±–ª–µ–º–∞: "relation 'users' does not exist"
**–†–µ—à–µ–Ω–∏–µ**: –í—ã–ø–æ–ª–Ω–∏—Ç–µ `scripts/setup-supabase-complete.sql` (—É–¥–∞–ª–∏—Ç –¥–∞–Ω–Ω—ã–µ!)

### –ü—Ä–æ–±–ª–µ–º–∞: "new row violates row-level security policy"
**–†–µ—à–µ–Ω–∏–µ**: 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ —Å–æ–∑–¥–∞–Ω—ã
2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –≤ SQL Editor:
   ```sql
   SELECT * FROM pg_policies WHERE tablename IN ('users', 'progress');
   ```
3. –ï—Å–ª–∏ –ø–æ–ª–∏—Ç–∏–∫ –Ω–µ—Ç, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `check-and-fix-schema.sql` —Å–Ω–æ–≤–∞

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**:
1. –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –æ—à–∏–±–∫–∏ (F12)
2. –ß—Ç–æ —Ç–∞–±–ª–∏—Ü—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç (Table Editor)
3. –ß—Ç–æ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
4. –ß—Ç–æ –∫–ª—é—á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤ `services/supabaseClient.ts`

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è
**–ü—Ä–æ–≤–µ—Ä—å—Ç–µ**:
1. –ö–æ–Ω—Å–æ–ª—å: `DB: Checking Supabase for Telegram ID...`
2. –ß—Ç–æ `telegram_id` –ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è:
   ```sql
   SELECT id, telegram_id, name FROM users;
   ```
3. –ß—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π UUID –∏–∑ –ë–î (–Ω–µ telegram_id –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞)

## üìä –ß—Ç–æ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

‚úÖ **–ü—Ä–∏ –≤—Ö–æ–¥–µ —á–µ—Ä–µ–∑ Telegram**:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –ø–æ `telegram_id`
- –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ –¥–∞–Ω–Ω—ã–µ: XP, –º–æ–Ω–µ—Ç—ã, —É—Ä–æ–≤–µ–Ω—å, –∏–Ω–≤–µ–Ω—Ç–∞—Ä—å
- –ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã `progress`
- –í—Å–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ

‚úÖ **–ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏**:
- –°–æ–∑–¥–∞–µ—Ç—Å—è –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `progress`
- –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è `xp`, `coins`, `level` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å LocalStorage

‚úÖ **–ü—Ä–∏ –ø–æ–∫—É–ø–∫–µ –ø—Ä–µ–¥–º–µ—Ç–∞**:
- –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è `coins` –∏ `inventory` –≤ —Ç–∞–±–ª–∏—Ü–µ `users`
- –î–∞–Ω–Ω—ã–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —Å LocalStorage

‚úÖ **–ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã**:
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ Supabase
- –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è
- –ü–æ–∫—É–ø–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è

## üéØ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `check-and-fix-schema.sql` –≤—Å–µ –¥–æ–ª–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å –∏–¥–µ–∞–ª—å–Ω–æ!

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –∏ –ª–æ–≥–∏ –≤ Supabase Dashboard.
